define("quizaccess_exproctor/screen_proctoring",["exports","jquery","core/ajax"],(function(_exports,_jquery,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);_exports.init=async props=>{let width=props.image_width,height=0,streaming=!1;if(null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length)return!1;if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length)return props.is_quiz_started=!1,!1;props.is_quiz_started&&(0,_jquery.default)("#mod_quiz_navblock").append('<div class="card-body p-3" style="display: none"><h3 class="no text-left">Screen</h3> <br/><video id="exproctor_video_sc">Screen stream not available.</video><canvas id="exproctor_canvas_sc" style="display:none;"></canvas><div class="exproctor_output_sc" style="display:none;"><img id="exproctor_photo_sc" alt="The picture will appear in this box."/></div></div>');let video=document.getElementById("exproctor_video_sc"),canvas=document.getElementById("exproctor_canvas_sc"),photo=document.getElementById("exproctor_photo_sc");const get_screen_share_permission=()=>navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}).then((stream=>{"monitor"!==stream.getVideoTracks()[0].getSettings().displaySurface&&(alert("This quiz requires Entire Screen sharing permission to start!"),get_screen_share_permission()),video.srcObject=stream,video.play()})).catch((()=>{alert("This quiz requires Screen Sharing permission to start!"),get_screen_share_permission()}));(0,_jquery.default)("#id_submitbutton").click((function(){localStorage.removeItem("attemptId"),localStorage.removeItem("bucketName"),props.is_quiz_started=!0,takescreenshot(),setInterval(takescreenshot,props.screenshotdelay)})),(0,_jquery.default)("#".concat((0,_jquery.default)("[id^=single_button].btn.btn-primary")[0].id)).click((function(){get_screen_share_permission()}));const takescreenshot=()=>{if(props.id=localStorage.getItem("attemptId"),props.is_quiz_started&&props.id){const context=canvas.getContext("2d");if(window.console.log(props),width&&height){canvas.width=width,canvas.height=height,context.drawImage(video,0,0,width,height);const data=canvas.toDataURL("image/png");photo.setAttribute("src",data),props.webcampicture=data;const params={courseid:props.courseid,attemptid:props.id,quizid:props.quizid,screenshot:data,bucketName:localStorage.getItem("bucketName")},request={methodname:"quizaccess_exproctor_send_screen_shot",args:params};window.console.log(params),_ajax.default.call([request])[0].done((data=>{window.console.log(data),0!==data.warnings.length&&video&&Notification.addNotification({message:"Something went wrong during taking the screen-shot.",type:"error"})})).fail((err=>{window.console.log("An error occurred (screen random): ".concat(err))}))}else(()=>{const context=canvas.getContext("2d");context.fillStyle="#AAA",context.fillRect(0,0,canvas.width,canvas.height);const data=canvas.toDataURL("image/png");photo.setAttribute("src",data)})()}};video&&video.addEventListener("canplay",(()=>{streaming||(props.is_quiz_started&&(width=270),height=video.videoHeight/(video.videoWidth/width),isNaN(height)&&(height=width/(4/3)),video.setAttribute("width",width),video.setAttribute("height",height),canvas.setAttribute("width",width),canvas.setAttribute("height",height),streaming=!0)}),!1)}}));

//# sourceMappingURL=screen_proctoring.min.js.map